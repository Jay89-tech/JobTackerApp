@model List<VisitorManagement.Controllers.CheckInViewModel>
@{
    ViewData["Title"] = "Check-Ins";
}

<link rel="stylesheet" href="~/css/checkindex.css" asp-append-version="true" />

<div class="checkins-header">
    <h1 class="checkins-title">
        <i class="fas fa-qrcode"></i>
        Check-Ins
    </h1>
    <div class="filter-tabs">
        <a href="@Url.Action("Index")" class="tab-btn active">
            <i class="fas fa-calendar-day"></i>
            Today
        </a>
        <a href="@Url.Action("Active")" class="tab-btn">
            <i class="fas fa-user-check"></i>
            Active
        </a>
    </div>
</div>

<div class="checkins-table">
    @if (Model != null && Model.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Visitor</th>
                    <th>Company</th>
                    <th>Host</th>
                    <th>Check-In Time</th>
                    <th>Check-Out Time</th>
                    <th>Location</th>
                    <th>Duration</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    var checkIn = item.CheckIn;
                    var visit = item.Visit;
                    var visitor = item.Visitor;
                    var duration = checkIn.CheckOutTime.HasValue
                    ? (checkIn.CheckOutTime.Value - checkIn.CheckInTime).TotalHours
                    : (DateTime.UtcNow - checkIn.CheckInTime).TotalHours;

                    <tr>
                        <td>
                            <div class="visitor-cell">@(visit?.VisitorName ?? "Unknown")</div>
                            <div style="font-size: 0.8rem; color: #94a3b8; margin-top: 0.25rem;">
                                @(visitor?.Email ?? visit?.VisitorEmail ?? "N/A")
                            </div>
                        </td>
                        <td>@(visit?.VisitorCompany ?? "N/A")</td>
                        <td>
                            <div>@(visit?.HostName ?? "N/A")</div>
                            <div style="font-size: 0.8rem; color: #94a3b8; margin-top: 0.25rem;">
                                @(visit?.HostDepartment ?? "")
                            </div>
                        </td>
                        <td>
                            <span class="time-badge">
                                <i class="fas fa-sign-in-alt"></i>
                                @checkIn.CheckInTime.ToString("hh:mm tt")
                            </span>
                        </td>
                        <td>
                            @if (checkIn.CheckOutTime.HasValue)
                            {
                                <span class="time-badge" style="background: #fee2e2; color: #991b1b;">
                                    <i class="fas fa-sign-out-alt"></i>
                                    @checkIn.CheckOutTime.Value.ToString("hh:mm tt")
                                </span>
                            }
                            else
                            {
                                <span style="color: #94a3b8; font-style: italic;">Not checked out</span>
                            }
                        </td>
                        <td>
                            <i class="fas fa-map-marker-alt" style="color: #94a3b8;"></i>
                            @checkIn.CheckInLocation
                        </td>
                        <td>
                            <span class="duration-badge">
                                @string.Format("{0:0.0} hrs", duration)
                            </span>
                        </td>
                        <td>
                            @if (!checkIn.CheckOutTime.HasValue)
                            {
                                <span class="active-indicator">
                                    <span class="active-dot"></span>
                                    Active
                                </span>
                            }
                            else
                            {
                                <span class="checkout-badge">
                                    <i class="fas fa-check"></i>
                                    Completed
                                </span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div style="text-align: center; padding: 4rem 2rem; color: #94a3b8;">
            <i class="fas fa-qrcode" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;"></i>
            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: #64748b;">No Check-Ins Found</h3>
            <p>There are no check-ins to display for the selected period.</p>
        </div>
    }
</div>