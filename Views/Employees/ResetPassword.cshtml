@model SkillsManagement.Models.Employee
@{
    ViewData["Title"] = "Reset Password";
}

<div class="page-header mb-4">
    <div>
        <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-outline-secondary mb-2">
            <i class="fas fa-arrow-left"></i> Back to Details
        </a>
        <h2>Reset Password</h2>
        <p class="text-muted">Set a new password for @Model.FullName</p>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mx-auto">
        <div class="card">
            <div class="card-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Important:</strong> You are about to reset the password for <strong>@Model.FullName</strong>.
                    Please ensure you provide this password to the employee securely.
                </div>

                <form asp-action="ResetPasswordConfirmed" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.Id" />

                    <div class="mb-3">
                        <label class="form-label">Employee</label>
                        <input type="text" class="form-control" value="@Model.FullName (@Model.Email)" readonly />
                    </div>

                    <div class="mb-3">
                        <label for="NewPassword" class="form-label">New Password <span class="text-danger">*</span></label>
                        <input type="password"
                               id="NewPassword"
                               name="NewPassword"
                               class="form-control"
                               placeholder="Enter new password"
                               required
                               minlength="6" />
                        <small class="text-muted">Minimum 6 characters</small>
                    </div>

                    <div class="mb-3">
                        <label for="ConfirmPassword" class="form-label">Confirm Password <span class="text-danger">*</span></label>
                        <input type="password"
                               id="ConfirmPassword"
                               name="ConfirmPassword"
                               class="form-control"
                               placeholder="Confirm new password"
                               required
                               minlength="6" />
                        <span id="passwordMatchError" class="text-danger" style="display: none;">Passwords do not match</span>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-danger btn-lg">
                            <i class="fas fa-key"></i> Reset Password
                        </button>
                        <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-secondary btn-lg">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const password = document.getElementById('NewPassword');
        const confirmPassword = document.getElementById('ConfirmPassword');
        const errorSpan = document.getElementById('passwordMatchError');
        const form = document.querySelector('form');

        function validatePassword() {
            if (password.value !== confirmPassword.value) {
                errorSpan.style.display = 'block';
                confirmPassword.setCustomValidity('Passwords do not match');
                return false;
            } else {
                errorSpan.style.display = 'none';
                confirmPassword.setCustomValidity('');
                return true;
            }
        }

        confirmPassword.addEventListener('input', validatePassword);
        password.addEventListener('input', validatePassword);

        form.addEventListener('submit', function(e) {
            if (!validatePassword()) {
                e.preventDefault();
                confirmPassword.focus();
                return false;
            }

            return confirm('Are you sure you want to reset this employee\'s password?');
        });
    </script>
}

@section Styles {
    <style>
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

            .form-actions .btn {
                flex: 1;
            }
    </style>
}