@model List<VisitorManagement.Models.Visit>
@{
    ViewData["Title"] = "Pending Visits";
}

<link rel="stylesheet" href="~/css/pedingv.css" asp-append-version="true" />

<div class="pending-header">
    <h1 class="pending-title">
        <i class="fas fa-clock"></i>
        Pending Approvals
    </h1>
    <span class="pending-count">@Model.Count</span>
</div>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success" style="margin-bottom: 1.5rem; background: #d1fae5; color: #065f46; border: none; border-radius: 10px; padding: 1rem;">
        <i class="fas fa-check-circle"></i> @TempData["Success"]
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger" style="margin-bottom: 1.5rem; background: #fee2e2; color: #991b1b; border: none; border-radius: 10px; padding: 1rem;">
        <i class="fas fa-exclamation-circle"></i> @TempData["Error"]
    </div>
}

<div class="pending-grid">
    @if (Model != null && Model.Any())
    {
        foreach (var visit in Model)
        {
            <div class="visit-card">
                <div class="visit-card-header">
                    <div class="visitor-info">
                        <div class="visitor-name">@visit.VisitorName</div>
                        <div class="visitor-company">
                            <i class="fas fa-building"></i>
                            @visit.VisitorCompany
                        </div>
                    </div>
                    <span class="visit-badge">Pending</span>
                </div>

                <div class="visit-details-grid">
                    <div class="detail-item">
                        <span class="detail-label"><i class="fas fa-calendar"></i> Visit Date</span>
                        <span class="detail-value">@visit.VisitDate.ToString("MMM dd, yyyy")</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"><i class="fas fa-clock"></i> Arrival Time</span>
                        <span class="detail-value">@visit.ExpectedArrivalTime.ToString("hh:mm tt")</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"><i class="fas fa-user"></i> Host</span>
                        <span class="detail-value">@visit.HostName</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label"><i class="fas fa-building"></i> Department</span>
                        <span class="detail-value">@visit.HostDepartment</span>
                    </div>
                </div>

                <div class="purpose-section">
                    <div class="purpose-label">Purpose of Visit</div>
                    <div class="purpose-text">@visit.PurposeOfVisit</div>
                </div>

                <div class="action-section">
                    <form asp-action="Approve" method="post" style="flex: 1;">
                        <input type="hidden" name="id" value="@visit.Id" />
                        <button type="submit" class="btn-approve" onclick="return confirm('Are you sure you want to approve this visit?')">
                            <i class="fas fa-check"></i>
                            Approve
                        </button>
                    </form>
                    <button type="button" class="btn-deny" onclick="openDenyModal('@visit.Id', '@visit.VisitorName')">
                        <i class="fas fa-times"></i>
                        Deny
                    </button>
                    <a href="@Url.Action("Details", new { id = visit.Id })" class="btn-details">
                        <i class="fas fa-info-circle"></i>
                        Details
                    </a>
                </div>
            </div>
        }
    }
    else
    {
        <div style="text-align: center; padding: 4rem 2rem; color: #94a3b8; background: white; border-radius: 15px;">
            <i class="fas fa-check-circle" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;"></i>
            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: #64748b;">All Caught Up!</h3>
            <p>There are no pending visits requiring approval.</p>
        </div>
    }
</div>

<!-- Deny Modal -->
<div id="denyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Deny Visit Request</h3>
            <button class="close-btn" onclick="closeDenyModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form asp-action="Deny" method="post">
            <input type="hidden" id="denyVisitId" name="id" />
            <div class="form-group">
                <label class="form-label">Visitor</label>
                <div id="denyVisitorName" style="padding: 0.875rem; background: #f8fafc; border-radius: 8px; font-weight: 600; color: #1e293b;"></div>
            </div>
            <div class="form-group">
                <label class="form-label">Reason for Denial *</label>
                <textarea name="reason" class="form-textarea" placeholder="Please provide a reason for denying this visit request..." required></textarea>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button type="button" onclick="closeDenyModal()" class="btn-details" style="flex: 1;">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button type="submit" class="btn-deny" style="flex: 1;">
                    <i class="fas fa-ban"></i>
                    Deny Visit
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function openDenyModal(visitId, visitorName) {
        document.getElementById('denyVisitId').value = visitId;
        document.getElementById('denyVisitorName').textContent = visitorName;
        document.getElementById('denyModal').style.display = 'block';
    }

    function closeDenyModal() {
        document.getElementById('denyModal').style.display = 'none';
    }

    window.onclick = function(event) {
        const modal = document.getElementById('denyModal');
        if (event.target == modal) {
            closeDenyModal();
        }
    }
</script>