@{
    ViewData["Title"] = "Training Statistics";
}

<div class="page-header mb-4">
    <div>
        <a asp-action="Index" class="btn btn-outline-secondary mb-2">
            <i class="fas fa-arrow-left"></i> Back to Trainings
        </a>
        <h2>Training Statistics</h2>
        <p class="text-muted">Comprehensive training analytics and insights</p>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="summary-card">
            <h3>@ViewBag.TotalTrainings</h3>
            <p>Total Trainings</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="summary-card">
            <h3>@ViewBag.TotalEmployees</h3>
            <p>Total Employees</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="summary-card">
            <h3>@ViewBag.ParticipationRate.ToString("F1")%</h3>
            <p>Participation Rate</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="summary-card">
            <h3>@ViewBag.SuggestionStats["HR Suggested"]</h3>
            <p>HR Suggested</p>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card chart-card">
            <div class="card-header">
                <h5>Status Distribution</h5>
            </div>
            <div class="card-body">
                <canvas id="statusChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card chart-card">
            <div class="card-header">
                <h5>HR Suggested vs Self-Enrolled</h5>
            </div>
            <div class="card-body">
                <canvas id="suggestionChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card chart-card">
            <div class="card-header">
                <h5>Monthly Training Trends</h5>
            </div>
            <div class="card-body">
                <canvas id="trendsChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5>Top Training Providers</h5>
            </div>
            <div class="card-body">
                @if (ViewBag.TopProviders != null && ((Dictionary<string, int>)ViewBag.TopProviders).Any())
                {
                    <div class="providers-list">
                        @foreach (var provider in (Dictionary<string, int>)ViewBag.TopProviders)
                        {
                            <div class="provider-item">
                                <div class="provider-name">
                                    <i class="fas fa-building"></i>
                                    <strong>@provider.Key</strong>
                                </div>
                                <div class="provider-stats">
                                    <span class="badge bg-primary">@provider.Value trainings</span>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-muted text-center py-3">No provider data available</p>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Status Distribution Chart
        const statusData = @Html.Raw(Json.Serialize(ViewBag.StatusDistribution ?? new Dictionary<string, int>()));
        const statusLabels = Object.keys(statusData);
        const statusValues = Object.values(statusData);

        const statusCtx = document.getElementById('statusChart').getContext('2d');
        new Chart(statusCtx, {
            type: 'doughnut',
            data: {
                labels: statusLabels,
                datasets: [{
                    data: statusValues,
                    backgroundColor: ['#28a745', '#17a2b8', '#ffc107'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Suggestion Stats Chart
        const suggestionData = @Html.Raw(Json.Serialize(ViewBag.SuggestionStats ?? new Dictionary<string, int>()));
        const suggestionLabels = Object.keys(suggestionData);
        const suggestionValues = Object.values(suggestionData);

        const suggestionCtx = document.getElementById('suggestionChart').getContext('2d');
        new Chart(suggestionCtx, {
            type: 'pie',
            data: {
                labels: suggestionLabels,
                datasets: [{
                    data: suggestionValues,
                    backgroundColor: ['#667eea', '#6c757d'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Monthly Trends Chart
        const trendsData = @Html.Raw(Json.Serialize(ViewBag.MonthlyTrends ?? new Dictionary<string, int>()));
        const trendsLabels = Object.keys(trendsData);
        const trendsValues = Object.values(trendsData);

        const trendsCtx = document.getElementById('trendsChart').getContext('2d');
        new Chart(trendsCtx, {
            type: 'line',
            data: {
                labels: trendsLabels,
                datasets: [{
                    label: 'Trainings',
                    data: trendsValues,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>
}

@section Styles {
    <style>
        .summary-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

            .summary-card h3 {
                font-size: 2.5rem;
                font-weight: 700;
                color: #667eea;
                margin: 0 0 10px 0;
            }

            .summary-card p {
                margin: 0;
                color: #666;
                font-weight: 600;
            }

        .chart-card {
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

            .chart-card .card-body {
                height: 300px;
            }

        .providers-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .provider-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

            .provider-item:hover {
                background: #e9ecef;
                transform: translateX(5px);
            }

        .provider-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .provider-name i {
                color: #667eea;
                font-size: 1.2rem;
            }

        .card-header h5 {
            margin: 0;
            font-weight: 600;
        }
    </style>
}