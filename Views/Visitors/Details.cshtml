@model VisitorManagement.Models.Visitor
@{
    ViewData["Title"] = "Visitor Details";
    var visits = ViewBag.Visits as List<VisitorManagement.Models.Visit>;
}

<link rel="stylesheet" href="~/css/visitd.css" asp-append-version="true" />

<div class="visitor-header">
    <h1 style="font-size: 1.75rem; font-weight: 700; color: #1e293b;">Visitor Profile</h1>
    <a href="@Url.Action("Index")" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Back to Visitors
    </a>
</div>

<div class="details-grid">
    <div class="visitor-profile-card">
        <div class="profile-header">
            <div class="profile-avatar">
                @Model.FullName?.Substring(0, 1).ToUpper()
            </div>
            <div class="profile-name">@Model.FullName</div>
            <div class="profile-company">
                <i class="fas fa-building"></i>
                @Model.Company
            </div>
        </div>

        <div class="profile-info">
            <div class="info-row">
                <div class="info-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Email Address</div>
                    <div class="info-value">@Model.Email</div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">
                    <i class="fas fa-phone"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Phone Number</div>
                    <div class="info-value">@Model.Phone</div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Member Since</div>
                    <div class="info-value">@Model.CreatedAt.ToString("MMMM dd, yyyy")</div>
                </div>
            </div>

            <div class="info-row">
                <div class="info-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Last Updated</div>
                    <div class="info-value">@Model.UpdatedAt.ToString("MMM dd, yyyy")</div>
                </div>
            </div>
        </div>
    </div>

    <div class="visits-card">
        <h2 class="card-title">
            <span>
                <i class="fas fa-calendar-alt"></i>
                Visit History
            </span>
            <span class="visit-count-badge">
                @(visits?.Count ?? 0) Total Visits
            </span>
        </h2>

        @if (visits != null && visits.Any())
        {
            var approvedCount = visits.Count(v => v.Status == "approved");
            var pendingCount = visits.Count(v => v.Status == "pending");
            var deniedCount = visits.Count(v => v.Status == "denied");

            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-number" style="color: #10b981;">@approvedCount</div>
                    <div class="stat-label">Approved</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" style="color: #f59e0b;">@pendingCount</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" style="color: #ef4444;">@deniedCount</div>
                    <div class="stat-label">Denied</div>
                </div>
            </div>

            <div class="visits-timeline">
                @foreach (var visit in visits)
                {
                    <div class="timeline-item @visit.Status.ToLower()">
                        <div class="timeline-header">
                            <div class="timeline-date">
                                @visit.VisitDate.ToString("MMMM dd, yyyy")
                            </div>
                            <span class="status-badge @visit.Status.ToLower()">
                                @visit.Status
                            </span>
                        </div>
                        <div class="timeline-details">
                            <div class="timeline-detail">
                                <i class="fas fa-clock"></i>
                                <span>@visit.ExpectedArrivalTime.ToString("hh:mm tt")</span>
                            </div>
                            <div class="timeline-detail">
                                <i class="fas fa-user-tie"></i>
                                <span>Host: @visit.HostName</span>
                            </div>
                            <div class="timeline-detail">
                                <i class="fas fa-building"></i>
                                <span>@visit.HostDepartment</span>
                            </div>
                            <div class="timeline-detail">
                                <i class="fas fa-clipboard"></i>
                                <span>@visit.PurposeOfVisit</span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div style="text-align: center; padding: 4rem 2rem; color: #94a3b8;">
                <i class="fas fa-calendar-times" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: #64748b;">No Visit History</h3>
                <p>This visitor hasn't made any visit requests yet.</p>
            </div>
        }
    </div>
</div>