@{
    ViewData["Title"] = "Broadcast Notification";
}

@section Styles {
    <link rel="stylesheet" href="~/css/broadcast.css" />
}

<div class="page-header mb-4">
    <div>
        <a asp-action="Index" class="btn btn-outline-secondary mb-2">
            <i class="fas fa-arrow-left"></i> Back
        </a>
        <h2>Broadcast Notification</h2>
        <p class="text-muted">Send important announcements to all active employees</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mx-auto">
        <!-- Warning Alert -->
        <div class="alert alert-warning alert-important">
            <div class="alert-icon">
                <i class="fas fa-exclamation-triangle fa-2x"></i>
            </div>
            <div class="alert-content">
                <h5><strong>Important Notice</strong></h5>
                <p>This will send a notification to <strong>ALL active employees</strong> in the system. Use this feature responsibly for organization-wide announcements only.</p>
                <ul class="mb-0">
                    <li>All active employees will receive this notification on their mobile app</li>
                    <li>This action will be logged in the audit trail</li>
                    <li>Please ensure your message is professional and appropriate</li>
                </ul>
            </div>
        </div>

        <!-- Broadcast Form -->
        <div class="card form-card">
            <div class="card-body">
                <form asp-action="SendBroadcast" method="post">
                    @Html.AntiForgeryToken()

                    <!-- Notification Details -->
                    <h5 class="section-title"><i class="fas fa-broadcast-tower"></i> Broadcast Details</h5>

                    <div class="mb-3">
                        <label for="title" class="form-label">Notification Title <span class="text-danger">*</span></label>
                        <input type="text"
                               id="title"
                               name="title"
                               class="form-control"
                               placeholder="e.g., Company-Wide Update, Holiday Announcement"
                               required
                               maxlength="100" />
                        <small class="text-muted">Keep it clear and concise (max 100 characters)</small>
                    </div>

                    <div class="mb-3">
                        <label for="message" class="form-label">Broadcast Message <span class="text-danger">*</span></label>
                        <textarea id="message"
                                  name="message"
                                  class="form-control"
                                  rows="6"
                                  placeholder="Write your announcement here. This will be sent to all active employees..."
                                  required
                                  maxlength="500"></textarea>
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">Maximum 500 characters</small>
                            <small class="text-muted"><span id="charCount">0</span> / 500</small>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="type" class="form-label">Notification Type <span class="text-danger">*</span></label>
                        <select id="type" name="type" class="form-select" required>
                            <option value="">Select Type</option>
                            <option value="Alert">🚨 Alert - Critical/Urgent Information</option>
                            <option value="Update">ℹ️ Update - General Information</option>
                            <option value="Suggestion">💡 Suggestion - Tips & Recommendations</option>
                        </select>
                        <small class="text-muted">Choose the appropriate type based on the nature of your message</small>
                    </div>

                    <!-- Quick Templates -->
                    <div class="mb-4">
                        <label class="form-label">Quick Templates</label>
                        <div class="quick-templates">
                            <button type="button" class="template-btn" onclick="loadTemplate('holiday')">
                                <i class="fas fa-calendar-day"></i> Holiday Notice
                            </button>
                            <button type="button" class="template-btn" onclick="loadTemplate('maintenance')">
                                <i class="fas fa-tools"></i> System Maintenance
                            </button>
                            <button type="button" class="template-btn" onclick="loadTemplate('meeting')">
                                <i class="fas fa-users"></i> All-Hands Meeting
                            </button>
                            <button type="button" class="template-btn" onclick="loadTemplate('policy')">
                                <i class="fas fa-file-alt"></i> Policy Update
                            </button>
                        </div>
                    </div>

                    <!-- Confirmation Checkbox -->
                    <div class="mb-4">
                        <div class="form-check confirmation-check">
                            <input class="form-check-input"
                                   type="checkbox"
                                   id="confirmBroadcast"
                                   required>
                            <label class="form-check-label" for="confirmBroadcast">
                                <strong>I confirm that this message is appropriate for broadcasting to all employees</strong>
                            </label>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-danger btn-lg">
                            <i class="fas fa-broadcast-tower"></i> Send Broadcast
                        </button>
                        <a asp-action="Index" class="btn btn-secondary btn-lg">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Preview Card -->
        <div class="card mt-4">
            <div class="card-header">
                <h5><i class="fas fa-mobile-alt"></i> Live Preview</h5>
            </div>
            <div class="card-body">
                <div class="notification-preview">
                    <div class="preview-device">
                        <div class="device-header">
                            <div class="device-time">9:41</div>
                            <div class="device-icons">
                                <i class="fas fa-signal"></i>
                                <i class="fas fa-wifi"></i>
                                <i class="fas fa-battery-full"></i>
                            </div>
                        </div>
                        <div class="preview-notification">
                            <div class="preview-icon" id="previewIcon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="preview-content">
                                <div class="preview-app">Skills Management</div>
                                <strong id="previewTitle">Your notification title will appear here</strong>
                                <p id="previewMessage">Your broadcast message will appear here as employees will see it on their mobile devices...</p>
                                <div class="preview-time">Just now</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Broadcast Statistics -->
        <div class="card mt-4">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Broadcast Information</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-4">
                        <div class="broadcast-stat">
                            <i class="fas fa-users fa-2x text-primary mb-2"></i>
                            <h3 class="mb-1">All Active</h3>
                            <p class="text-muted mb-0">Employees will receive this</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="broadcast-stat">
                            <i class="fas fa-mobile-alt fa-2x text-success mb-2"></i>
                            <h3 class="mb-1">Instant</h3>
                            <p class="text-muted mb-0">Delivered immediately</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="broadcast-stat">
                            <i class="fas fa-history fa-2x text-info mb-2"></i>
                            <h3 class="mb-1">Tracked</h3>
                            <p class="text-muted mb-0">Action will be logged</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Character counter
        const messageTextarea = document.getElementById('message');
        const charCount = document.getElementById('charCount');

        messageTextarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });

        // Live preview
        document.getElementById('title').addEventListener('input', function(e) {
            document.getElementById('previewTitle').textContent =
                e.target.value || 'Your notification title will appear here';
        });

        document.getElementById('message').addEventListener('input', function(e) {
            document.getElementById('previewMessage').textContent =
                e.target.value || 'Your broadcast message will appear here as employees will see it on their mobile devices...';
        });

        document.getElementById('type').addEventListener('change', function(e) {
            const icon = document.getElementById('previewIcon');
            const iconElement = icon.querySelector('i');

            iconElement.className = '';
            switch(e.target.value) {
                case 'Alert':
                    iconElement.className = 'fas fa-exclamation-circle';
                    icon.style.background = '#dc3545';
                    break;
                case 'Update':
                    iconElement.className = 'fas fa-info-circle';
                    icon.style.background = '#0dcaf0';
                    break;
                case 'Suggestion':
                    iconElement.className = 'fas fa-lightbulb';
                    icon.style.background = '#ffc107';
                    break;
                default:
                    iconElement.className = 'fas fa-bell';
                    icon.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }
        });

        // Quick templates
        function loadTemplate(type) {
            const templates = {
                holiday: {
                    title: 'Holiday Notice - Office Closure',
                    message: 'Please be informed that the office will be closed on [DATE] for [HOLIDAY NAME]. Regular operations will resume on [DATE]. Enjoy the holiday!',
                    type: 'Update'
                },
                maintenance: {
                    title: 'Scheduled System Maintenance',
                    message: 'The Skills Management System will undergo scheduled maintenance on [DATE] from [TIME] to [TIME]. Please ensure all your work is saved. We apologize for any inconvenience.',
                    type: 'Alert'
                },
                meeting: {
                    title: 'All-Hands Company Meeting',
                    message: 'Join us for an important all-hands meeting on [DATE] at [TIME] in [LOCATION]. Attendance is mandatory. The meeting will cover [TOPICS]. See you there!',
                    type: 'Alert'
                },
                policy: {
                    title: 'Company Policy Update',
                    message: 'We have updated our [POLICY NAME] policy effective [DATE]. Please review the new policy in the company handbook. Contact HR if you have any questions.',
                    type: 'Update'
                }
            };

            const template = templates[type];
            if (template) {
                document.getElementById('title').value = template.title;
                document.getElementById('message').value = template.message;
                document.getElementById('type').value = template.type;

                // Trigger input events to update preview and character count
                document.getElementById('title').dispatchEvent(new Event('input'));
                document.getElementById('message').dispatchEvent(new Event('input'));
                document.getElementById('type').dispatchEvent(new Event('change'));
            }
        }

        // Form submission confirmation
        document.querySelector('form').addEventListener('submit', function(e) {
            const confirmed = document.getElementById('confirmBroadcast').checked;
            if (!confirmed) {
                e.preventDefault();
                alert('Please confirm that you want to send this broadcast to all employees.');
                return false;
            }

            const confirmation = confirm(
                'Are you sure you want to send this broadcast to ALL active employees?\n\n' +
                'This action cannot be undone.'
            );

            if (!confirmation) {
                e.preventDefault();
                return false;
            }
        });
    </script>
}